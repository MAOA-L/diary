{% extends "base/frame.html" %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static "css/editormd.css" %}" />
    <link rel="stylesheet" href="{% static "css/style.css" %}">
{% endblock %}
{% block style %}
        <style>
            .page-content{
                padding: 0 !important;
            }
            .input-group {
                position: relative;
                display: table;
                border-collapse: separate;
            }
        .row span, .row input, .row button{
            background-color: #252a2f;
        }
        .btn .btn-default, .btn-default:hover, .btn-default:active, .btn-default:focus,.open>.dropdown-toggle.btn-default,
        .open>.dropdown-toggle.btn-default:hover,.open>.dropdown-toggle.btn-default:focus,
        .open>.dropdown-toggle.btn-default:active{
            color: #e6e6e6;
            background-color: #333;
            border-color: #adadad;
        }
        .dropdown-menu>li>a:focus, .dropdown-menu>li>a:hover {
            color: #262626;
            text-decoration: none;
            background-color: #d5eaea;
        }
        .input-group-addon, #titleName, .input-group-btn button{
            border: none !important;
            border-radius: 0 !important;
            height: 34px;
        }
        </style>
    {% endblock %}
{% block xadmin_title %}{{ xadmin.publish.title }}{% endblock %}
{% block content %}
<div class="row">
  <div class="col-lg-12">
    <div class="input-group">
      <span class="input-group-addon" style="color: white;">输入文章标题</span>
      <input type="text" class="form-control" placeholder="标题" aria-label="..." style="color: white" id="titleName">
      <div class="input-group-btn">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span id="sortName">分类</span>
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right sortName">
          <li><a href="#">Action</a></li>
          <li><a href="#">Another action</a></li>
          <li><a href="#">Something else here</a></li>
          <li role="separator" class="divider"></li>
          <li><a href="#">Separated link</a></li>
        </ul>
      </div>
        <div class="input-group-btn">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span id="labelName">标签</span>
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right labelName">
              <li><a href="#">Action</a></li>
              <li><a href="#">Another action</a></li>
              <li><a href="#">Something else here</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="#">Separated link</a></li>
            </ul>
        </div>
    </div><!-- /input-group -->
  </div><!-- /.col-lg-6 -->
</div><!-- /.row -->

    <div id="editormd">
        <textarea style="display:none;"></textarea>
    </div>

{% endblock %}
{% block script %}
    <script src="{% static "js/editormd.js" %}"></script>
    <script>
        let left_nav_width = $("div.left-nav").outerWidth(),
            document_height = $(window).height(),
            document_width = $(document).width();
        let left_nav_width_temp = left_nav_width;
        let timer;
        function give_height() {
            if(timer){
                clearTimeout(timer);
            }
            timer = setTimeout(function () {
                document_height = $(document).height();
                document_width = $(document).width();
                {#alert($(window).height()+","+$(document).height())#}
                if (document_width <= 1024){
                    left_nav_width_temp = 0;
                }else{
                    left_nav_width_temp = left_nav_width;
                }
                $("div.content").css("height", document_height-50+"px");
                $("#editormd, div.CodeMirror, div.editormd-preview").css("height", document_height - 50 + "px");
                timer = null;
                console.log($(".editormd-preview").html());

            },0)
        }
        (function () {
            give_height();
        })();

        $(function() {
            $(window).resize(function () {
                give_height();
            });
            testEditor = editormd("editormd", {
                width: "inherit",
                height: "100%",
                margin: "0 0 0",
                value: '',
                flowChart: true,
                tex: true,
                // Editor.md theme, default or dark, change at v1.5.0
                // You can also custom css class .editormd-preview-theme-xxxx
                theme: (localStorage.theme) ? localStorage.theme : "dark",

                // Preview container theme, added v1.5.0
                // You can also custom css class .editormd-preview-theme-xxxx
                previewTheme: (localStorage.previewTheme) ? localStorage.previewTheme : "dark",

                // Added @v1.5.0 & after version is CodeMirror (editor area) theme
                editorTheme: (localStorage.editorTheme) ? localStorage.editorTheme : "pastel-on-dark",
                path: '/static/lib/'
            });
            /**
             * 改变分类名
             */
            $("ul.sortName li a").click(function () {
                $("#sortName").html($(this).html())
            });
            $("ul.labelName li a").click(function () {
                $("#labelName").html($(this).html())
            })
        });
            document.addEventListener('visibilitychange', function () {
                let isHidden = document.hidden;
                if (isHidden) {
                    document.title = document.title + '-不写文章跑去干嘛';
                } else {
                    document.title = '发表';
                }
            });
            window.onbeforeunload = function (event) {
                return "提示：您尚有未保存的内容，离开本页将丢失编辑内容！:)";
            };

    </script>
{% endblock %}




